#!/bin/bash

action=$1

case $action in
    add) ;;
    del) ;;
    old) ;;
    *) exit 0;;
esac

if [[ $# < 3 ]]; then
    exit 1
fi

mac_address=$2
ip_address=$3

if [[ "$action" == "del" ]]; then
    lease_remaining=0
else
    lease_remaining=$DNSMASQ_TIME_REMAINING
fi

echo <<EOF | socat - UNIX-CONNECT:$QUANTUM_RELAY_SOCKET_PATH
{
    "network_id": "$QUANTUM_NETWORK_ID",
    "mac_address": "$mac_address",
    "ip_address": "$ip_address",
    "lease_remaining": $lease_remaining
}
EOF
